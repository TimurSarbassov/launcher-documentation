// This is a parameterized module. Parameters used:
//
//   parameter-custom-catalog: A custom catalog is used instead of the default one
//
// Rationale: This module is useful both when setting up minishift as is and when testing a local
// booster catalog.

[id='installing-launcher-tool-using-an-operator_{context}']
= Installing {name-launcher} tool using an operator
//link:https://docs.openshift.org/latest/minishift/using/addons.html[Add-ons] enable you to extend the behavior of {OpenShiftLocal}, and the {name-launcher} tool link:https://github.com/minishift/minishift-addons/tree/master/add-ons/fabric8-launcher[provides an add-on] as an installation option.

.Prerequisites

* Administrative access privileges to an OpenShift Cluster.
* The link:https://github.com/fabric8-launcher/launcher-operator/tree/master[GitHub repository] containing the Launcher operator templates cloned locally on your system.
//* The `cluster-admin` role assigned to your user account on the target OpenShift cluster.
//* A link:{link-guide-minishift-installation}#creating-a-github-personal-access-token_minishift[GitHub personal access token].


.Procedure

. Assign the `cluster-admin` role to your user account on the OpenShift cluster.
+
[source,bash,options="nowrap",subs="attributes+"]
----
$ oc adm policy --as system:admin add-cluster-role-to-user cluster-admin USER_ACCOUNT_NAME
----

// TODO: fix up variable in code example:
. Log in to your {OpenShiftLocal}:
+
[source,bash,options="nowrap",subs="attributes+"]
----
$ oc login {value-url-osl-auth}
----

. Create a project to host the operator:
+
[source,bash,options="nowrap",subs="attributes+"]
----
$ oc new-project launcher-operator
----

. link:https://help.github.com/en/articles/creating-a-personal-access-token-for-the-command-line[Create a personal GitHub access token]. Ensure that you set the following scope when creating the token:
// https://developer.github.com/apps/building-oauth-apps/authorizing-oauth-apps/

* `repo`
* `admin:repo_hook`
* `delete_repo`

. Create a new secret using the personal GitHub access token:
+
[source,bash,options="nowrap",subs="attributes+"]
----
$ oc create secret generic launcher-secrets --from-literal=github-token=GITHUB_TOKEN
----

// TODO: add the clone repo step here, too
. Navigate to the directory containing the cloned operator resources.
+
[source,bash,options="nowrap",subs="attributes+"]
----
$ cd launcher operator
----

. Process the YAML templates in the `/deploy` subdirectory:
+
[source,bash,options="nowrap",subs="attributes+"]
----
$  oc create -R -f ./deploy
----
+
Based on the templates, OpenShift automatically creates:

* a custom resource definition for the Launcher operator,
* a service account for the Launcher operator,
* access role definitions for the launcher operator, and
* access role bindings for the Launcher operator.

. Create the custom resource for the Launcher application.
+
[source,bash,options="nowrap",subs="attributes+"]
----
$ oc create -f example/launcher_cr.yaml
----

. Monitor the status of the {name-launcher} tool until it completes start up.
+
[source,bash,options="nowrap",subs="attributes+"]
----
$ oc get pods -w
NAME                           READY     STATUS              RESTARTS   AGE
configmapcontroller-1-deploy   1/1       Running             0          46s
configmapcontroller-1-aaaaa    0/1       ContainerCreating   0          44s
launcher-backend-1-deploy      1/1       Running             0          46s
...
launcher-backend-2-aaaaa       0/1       Running             0         5s
launcher-frontend-2-aaaaa      0/1       Running             0         6s
----

. Obtain the route of your {name-launcher} tool.
+
[source,bash,options="nowrap",subs="attributes+"]
----
$ oc get routes
NAME       HOST/PORT                                PATH      SERVICES            PORT      TERMINATION   WILDCARD
launcher   launcher.{value-route-osl-hostname}             launcher-frontend   <all>                   None
----

. Navigate to your {name-launcher} tool and start using your {name-launcher} tool to create a new application or launch one for the available examples.

////
.Additional Resources
* See the link:{link-guide-getting-started}[{name-guide-getting-started}] for a walk-through of running a booster application.
* Read the runtime guides for an overview of the runtimes and their boosters:
** link:{link-guide-spring-boot}[{name-guide-spring-boot}]
** link:{link-guide-vertx}[{name-guide-vertx}]
** link:{link-guide-thorntail}[{name-guide-thorntail}]
** link:{link-guide-nodejs}[{name-guide-nodejs}]
////
