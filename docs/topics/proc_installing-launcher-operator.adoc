// Redefines the value of the URL placeholder from minishift-specific to a more general value.
:value-url-osl-auth: OPENSHIFT_CLUSTER_URL

[id='installing-launcher-tool-using-an-operator_{context}']
= Installing the {name-launcher} tool using an operator

Set up an operator to install the {name-launcher} tool on an OpenShift cluster.
The following procedure works with clusters running OpenShift 3.11.

.Prerequisites

* Administrative access privileges to an OpenShift cluster using.

.Procedure

. Assign the `cluster-admin` role to your user account on the OpenShift cluster.
+
[source,bash,options="nowrap",subs="attributes+"]
----
$ oc adm policy --as system:admin add-cluster-role-to-user cluster-admin USER_ACCOUNT_NAME
----

. Log in to your {OpenShiftCluster} using your credentials:
+
[source,bash,options="nowrap",subs="attributes+"]
----
$ oc login {value-url-osl-auth}
----

. Create a project to host the operator:
+
[source,bash,options="nowrap",subs="attributes+"]
----
$ oc new-project launcher-operator
----

. link:https://help.github.com/en/articles/creating-a-personal-access-token-for-the-command-line[Create a personal GitHub access token].
Ensure that you set the following scope when creating the token:
// TODO: replace this with OAuth: https://developer.github.com/apps/building-oauth-apps/authorizing-oauth-apps/

* `repo`
* `admin:repo_hook`
* `delete_repo`

. Create a new secret using your newly created personal GitHub access token:
+
[source,bash,options="nowrap",subs="attributes+"]
----
$ oc create secret generic launcher-secrets --from-literal=github-token=GITHUB_TOKEN
----

. Clone the link:https://github.com/fabric8-launcher/launcher-operator[repository] containing the operator and navigate to the directory containing the cloned resources.
+
[source,bash,options="nowrap",subs="attributes+"]
----
$ git clone git@github.com:fabric8-launcher/launcher-operator.git
$ cd launcher-operator
----

. Process the YAML templates in the `/deploy` subdirectory:
+
[source,bash,options="nowrap",subs="attributes+"]
----
$  oc create -R -f ./deploy
----
+
Based on the templates, OpenShift automatically creates:

* a custom resource definition for the Launcher operator,
* a service account for the Launcher operator,
* access role definitions for the launcher operator, and
* access role bindings for the Launcher operator.

. Create the custom resource for the Launcher application.
+
[source,bash,options="nowrap",subs="attributes+"]
----
$ oc create -f example/launcher_cr.yaml
----

. Monitor the status of the {name-launcher} tool until it completes start up.
+
[source,bash,options="nowrap",subs="attributes+"]
----
$ oc get pods -w
NAME                           READY     STATUS              RESTARTS   AGE
configmapcontroller-1-deploy   1/1       Running             0          46s
configmapcontroller-1-aaaaa    0/1       ContainerCreating   0          44s
launcher-backend-1-deploy      1/1       Running             0          46s
...
launcher-backend-2-aaaaa       0/1       Running             0         5s
launcher-frontend-2-aaaaa      0/1       Running             0         6s
----

. Obtain the route of your {name-launcher} tool.
+
[source,bash,options="nowrap",subs="attributes+"]
----
$ oc get routes
NAME       HOST/PORT                                PATH      SERVICES            PORT      TERMINATION   WILDCARD
launcher   launcher.{value-route-osl-hostname}                launcher-frontend   <all>                   None
----

. Navigate to the route URL to start using {name-launcher}.

.Additional Resources
* See the link:{link-guide-getting-started}[{name-guide-getting-started}] for a walk-through of launching an example application.
* Read the runtime guides for an overview of the runtimes and their examples:
** link:{link-guide-spring-boot}[{name-guide-spring-boot}]
** link:{link-guide-vertx}[{name-guide-vertx}]
** link:{link-guide-thorntail}[{name-guide-thorntail}]
** link:{link-guide-nodejs}[{name-guide-nodejs}]
